!function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?module.exports=t():e.LocalStorageCache=t()}(this,function(){var e={add:function(e,t,o){"object"==typeof vallue&&(t=JSON.stringify(t)),o=this._getExp(o);var r={data:t,expired:o,time:+new Date};localStorage.setItem(e,JSON.stringify(r))},get:function(e,t){var o=JSON.parse(localStorage.getItem(e)),r=$.Deferred(),n=this;if(null==o)t?t().fail(function(){r.reject(null)}).done(function(t){n.add(e,t),r.resolve(t)}):r.reject(null);else if(o.expired>0){var a=+new Date;a>o.expired?t?t().fail(function(){r.reject(o.data)}).done(function(t){n.update(e,t),r.resolve(t)}):r.reject(null):r.resolve(o.data)}else r.resolve(o.data);return r.promise()},remove:function(e){localStorage.removeItem(e)},clear:function(){localStorage.clear()},update:function(e,t,o){"object"==typeof vallue&&(t=JSON.stringify(t)),o=this._getExp(o);var r=JSON.parse(localStorage.getItem(e));null!=r&&("undefined"==typeof o||""==o?o=r.expired:null);var n={data:t,expired:o,time:+new Date};localStorage.setItem(e,JSON.stringify(n))},setExpired:function(e,t){t=this._getExp(t);var o=JSON.parse(localStorage.getItem(e));o.expired=t,localStorage.setItem(e,JSON.stringify(o))},_getExp:function(e){if(0==e){var t=this;window.onbeforeunload=function(){t.remove(key)}}else if("number"!=typeof e&&isNaN(Number(e)))"object"==typeof e&&(e=e.getTime()||-1);else{var o=+new Date;e=o+1e3*e}return e}};return e});